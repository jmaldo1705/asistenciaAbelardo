<div class="container">
  <!-- Encabezado con estad√≠sticas -->
  <div class="header">
    <!-- Banner del evento con im√°genes -->
    <div class="event-banner">
      <div class="banner-images">
        <img src="assets/abelardo.png" alt="Abelardo de la Espriella" class="leader-photo">
        <div class="event-title-section">
          <h1>
            <span class="title-line-1">Convenci√≥n Nacional</span>
            <div class="defensores-logo-banner">
              <img src="assets/defensores.png" alt="Defensores de la Patria" class="defensores-image-banner">
            </div>
          </h1>
          <p class="event-subtitle">¬°COLOMBIA ESCUCHAR√Å LO DURO QUE RUGEN LOS TIGRES!</p>
          <div class="event-details">
            <span class="event-date">üìÖ Lunes 3 de Noviembre - 3:00 p.m.</span>
            <span class="event-location">üìç Movistar Arena - Bogot√°</span>
          </div>
          <p class="event-leader">Abelardo de la Espriella - Nuestro M√°ximo L√≠der</p>
        </div>
        <img src="assets/tigre.png" alt="Tigre" class="tiger-image">
      </div>
    </div>

    <!-- Bot√≥n de cerrar sesi√≥n -->
    <div class="logout-section">
      <button class="btn-logout" (click)="logout()" title="Cerrar sesi√≥n">
        üö™ Cerrar Sesi√≥n
      </button>
    </div>

    <div class="stats-cards">
      <div class="stat-card total">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.total }}</div>
          <div class="stat-label">Total</div>
        </div>
      </div>
      <div class="stat-card confirmed">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.confirmados }}</div>
          <div class="stat-label">Confirmados</div>
        </div>
      </div>
      <div class="stat-card pending">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.pendientes }}</div>
          <div class="stat-label">Pendientes</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√≥n para agregar nuevo coordinador -->
  <div class="action-bar">
    <button class="btn-nuevo" (click)="abrirModalNuevo()">
      ‚ûï Agregar Coordinador
    </button>
    <button class="btn-exportar" (click)="exportarAExcel()">
      üìä Exportar a Excel
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <div class="filter-group">
      <label>üîç Buscar:</label>
      <input
        type="text"
        [(ngModel)]="filtroMunicipio"
        (ngModelChange)="resetearPaginacion()"
        placeholder="Buscar por municipio, nombre, celular u observaciones..."
        class="filter-input">
    </div>
    <div class="filter-group">
      <label>üìä Estado:</label>
      <select [(ngModel)]="filtroEstado" (ngModelChange)="resetearPaginacion()" class="filter-select">
        <option value="todos">Todos</option>
        <option value="confirmados">Confirmados</option>
        <option value="pendientes">Pendientes</option>
      </select>
    </div>
  </div>

  <!-- Tabla de coordinadores -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Municipio</th>
          <th>Coordinador</th>
          <th>Celular</th>
          <th>Estado</th>
          <th>Invitados</th>
          <th>Fecha Llamada</th>
          <th>Observaciones</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let coordinador of coordinadoresPaginados"
            [class.confirmado-row]="coordinador.confirmado">
          <td><strong>{{ coordinador.municipio }}</strong></td>
          <td>{{ coordinador.nombreCompleto }}</td>
          <td>
            <a href="tel:{{ coordinador.celular }}" class="phone-link">
              {{ coordinador.celular }}
            </a>
          </td>
          <td>
            <span class="badge" [class.badge-success]="coordinador.confirmado" [class.badge-pending]="!coordinador.confirmado">
              {{ coordinador.confirmado ? 'Confirmado' : 'Pendiente' }}
            </span>
          </td>
          <td class="invitados-cell">
            <span class="invitados-number">{{ coordinador.numeroInvitados }}</span>
          </td>
          <td class="fecha-cell">{{ formatearFecha(coordinador.fechaLlamada) }}</td>
          <td class="observaciones-cell">{{ coordinador.observaciones || '-' }}</td>
          <td>
            <div class="action-buttons">
              <button
                class="btn btn-edit"
                (click)="abrirModalEditar(coordinador)"
                title="Editar coordinador">
                ‚úèÔ∏è
              </button>
              <button
                *ngIf="!coordinador.confirmado"
                class="btn btn-primary"
                (click)="abrirModalConfirmacion(coordinador)"
                title="Confirmar llamada">
                ‚úì
              </button>
              <button
                *ngIf="coordinador.confirmado"
                class="btn btn-warning"
                (click)="desmarcarConfirmacion(coordinador)"
                title="Desmarcar confirmaci√≥n">
                ‚Ü∫
              </button>
              <button
                class="btn btn-info"
                (click)="verInvitados(coordinador)"
                [disabled]="!coordinador.confirmado"
                title="Ver/Agregar invitados">
                üë•
              </button>
              <button
                class="btn btn-danger"
                (click)="eliminarCoordinador(coordinador)"
                title="Eliminar">
                <span class="icon-delete">üóë</span>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="coordinadoresFiltrados.length === 0">
          <td colspan="8" class="empty-message">
            No se encontraron coordinadores
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Controles de paginaci√≥n -->
  <div class="pagination-container" *ngIf="coordinadoresFiltrados.length > 0">
    <div class="pagination-info">
      <span>Mostrando {{ (paginaActual - 1) * itemsPorPagina + 1 }} -
        {{ Math.min(paginaActual * itemsPorPagina, coordinadoresFiltrados.length) }}
        de {{ coordinadoresFiltrados.length }} coordinadores</span>

      <div class="items-per-page">
        <label>Mostrar:</label>
        <select (change)="cambiarItemsPorPagina($event)" [value]="itemsPorPagina" class="page-size-select">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>por p√°gina</span>
      </div>
    </div>

    <div class="pagination-controls" *ngIf="totalPaginas > 1">
      <button
        class="page-btn"
        (click)="cambiarPagina(1)"
        [disabled]="paginaActual === 1"
        title="Primera p√°gina">
        ‚ü™
      </button>
      <button
        class="page-btn"
        (click)="cambiarPagina(paginaActual - 1)"
        [disabled]="paginaActual === 1"
        title="P√°gina anterior">
        ‚Äπ
      </button>

      <button
        *ngFor="let pagina of paginasArray"
        class="page-btn"
        [class.active]="pagina === paginaActual"
        (click)="cambiarPagina(pagina)">
        {{ pagina }}
      </button>

      <button
        class="page-btn"
        (click)="cambiarPagina(paginaActual + 1)"
        [disabled]="paginaActual === totalPaginas"
        title="P√°gina siguiente">
        ‚Ä∫
      </button>
      <button
        class="page-btn"
        (click)="cambiarPagina(totalPaginas)"
        [disabled]="paginaActual === totalPaginas"
        title="√öltima p√°gina">
        ‚ü´
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmaci√≥n de llamada -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üìû Confirmar Llamada</h2>
      <button class="close-btn" (click)="cerrarModal()">‚úï</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorSeleccionado">
      <div class="modal-info">
        <p><strong>Municipio:</strong> {{ coordinadorSeleccionado.municipio }}</p>
        <p><strong>Coordinador:</strong> {{ coordinadorSeleccionado.nombreCompleto }}</p>
        <p><strong>Celular:</strong> {{ coordinadorSeleccionado.celular }}</p>
      </div>

      <div class="form-group">
        <label>¬øCu√°ntos invitados confirm√≥?</label>
        <input
          type="number"
          [(ngModel)]="numeroInvitados"
          min="0"
          class="form-control"
          placeholder="N√∫mero de invitados">
      </div>

      <div class="form-group">
        <label>Observaciones</label>
        <textarea
          [(ngModel)]="observaciones"
          rows="4"
          class="form-control"
          placeholder="Notas adicionales de la llamada..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModal()">Cancelar</button>
      <button class="btn btn-success" (click)="confirmarLlamada()">‚úÖ Confirmar Llamada</button>
    </div>
  </div>
</div>

<!-- Modal para nuevo coordinador -->
<div class="modal-overlay" *ngIf="mostrarModalNuevo" (click)="cerrarModalNuevo()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ûï Nuevo Coordinador</h2>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Municipio *</label>
        <input
          type="text"
          [(ngModel)]="nuevoCoordinador.municipio"
          class="form-control"
          placeholder="Nombre del municipio">
      </div>

      <div class="form-group">
        <label>Nombre Completo *</label>
        <input
          type="text"
          [(ngModel)]="nuevoCoordinador.nombreCompleto"
          class="form-control"
          placeholder="Nombre completo del coordinador">
      </div>

      <div class="form-group">
        <label>Celular *</label>
        <input
          type="tel"
          [(ngModel)]="nuevoCoordinador.celular"
          class="form-control"
          placeholder="N√∫mero de celular">
      </div>

      <p class="form-note">* Campos obligatorios</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalNuevo()">Cancelar</button>
      <button class="btn btn-primary" (click)="guardarNuevoCoordinador()">üíæ Guardar</button>
    </div>
  </div>
</div>

<!-- Modal de confirmaci√≥n para eliminar coordinador -->
<div class="modal-overlay" *ngIf="mostrarModalEliminar" (click)="cerrarModalEliminar()">
  <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-header modal-header-danger">
      <h2>‚ö†Ô∏è Confirmar Eliminaci√≥n</h2>
      <button class="close-btn" (click)="cerrarModalEliminar()">‚úï</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorAEliminar">
      <div class="confirm-icon">
        <span class="icon-warning">üóëÔ∏è</span>
      </div>
      <p class="confirm-message">
        ¬øEst√° seguro de que desea eliminar a este coordinador?
      </p>
      <div class="confirm-details">
        <p><strong>Municipio:</strong> {{ coordinadorAEliminar.municipio }}</p>
        <p><strong>Coordinador:</strong> {{ coordinadorAEliminar.nombreCompleto }}</p>
        <p><strong>Celular:</strong> {{ coordinadorAEliminar.celular }}</p>
        <p *ngIf="coordinadorAEliminar.confirmado" class="warning-text">
          ‚ö†Ô∏è Este coordinador tiene {{ coordinadorAEliminar.numeroInvitados }} invitados confirmados
        </p>
      </div>
      <p class="confirm-warning">
        <strong>Esta acci√≥n no se puede deshacer.</strong>
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEliminar()">Cancelar</button>
      <button class="btn btn-danger" (click)="confirmarEliminar()">
        üóëÔ∏è S√≠, Eliminar
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmaci√≥n para desmarcar -->
<div class="modal-overlay" *ngIf="mostrarModalDesmarcar" (click)="cerrarModalDesmarcar()">
  <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-header modal-header-warning">
      <h2>‚ö†Ô∏è Desmarcar Confirmaci√≥n</h2>
      <button class="close-btn" (click)="cerrarModalDesmarcar()">‚úï</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorADesmarcar">
      <div class="confirm-icon">
        <span class="icon-warning">‚Ü∫</span>
      </div>
      <p class="confirm-message">
        ¬øEst√° seguro de que desea desmarcar la confirmaci√≥n de llamada?
      </p>
      <div class="confirm-details">
        <p><strong>Municipio:</strong> {{ coordinadorADesmarcar.municipio }}</p>
        <p><strong>Coordinador:</strong> {{ coordinadorADesmarcar.nombreCompleto }}</p>
        <p><strong>Invitados registrados:</strong> {{ coordinadorADesmarcar.numeroInvitados }}</p>
      </div>
      <p class="confirm-warning">
        ‚ö†Ô∏è <strong>Importante:</strong> Esto marcar√° al coordinador como "Pendiente" nuevamente,
        borrar√° la fecha de llamada y <strong>eliminar√° todos los invitados registrados</strong>.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalDesmarcar()">Cancelar</button>
      <button class="btn btn-warning" (click)="confirmarDesmarcar()">
        ‚Ü∫ S√≠, Desmarcar
      </button>
    </div>
  </div>
</div>

<!-- Modal para editar coordinador -->
<div class="modal-overlay" *ngIf="mostrarModalEditar" (click)="cerrarModalEditar()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚úèÔ∏è Editar Coordinador</h2>
      <button class="close-btn" (click)="cerrarModalEditar()">‚úï</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorEditando">
      <div class="form-group">
        <label>Municipio *</label>
        <input
          type="text"
          [(ngModel)]="coordinadorEditando.municipio"
          class="form-control"
          placeholder="Nombre del municipio">
      </div>

      <div class="form-group">
        <label>Nombre Completo *</label>
        <input
          type="text"
          [(ngModel)]="coordinadorEditando.nombreCompleto"
          class="form-control"
          placeholder="Nombre completo del coordinador">
      </div>

      <div class="form-group">
        <label>Celular *</label>
        <input
          type="tel"
          [(ngModel)]="coordinadorEditando.celular"
          class="form-control"
          placeholder="N√∫mero de celular">
      </div>

      <div class="form-group">
        <label>Fecha de Llamada</label>
        <input
          type="datetime-local"
          [(ngModel)]="fechaLlamadaEdicion"
          class="form-control">
      </div>

      <div class="form-group">
        <label>Observaciones</label>
        <textarea
          [(ngModel)]="coordinadorEditando.observaciones"
          rows="4"
          class="form-control"
          placeholder="Observaciones adicionales..."></textarea>
      </div>

      <p class="form-note">* Campos obligatorios</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEditar()">Cancelar</button>
      <button class="btn btn-primary" (click)="guardarEdicion()">üíæ Guardar Cambios</button>
    </div>
  </div>
</div>
