<div class="container">
  <!-- Encabezado con estadÃ­sticas -->
  <div class="header">
    <!-- Banner del evento con imÃ¡genes -->
    <div class="event-banner">
      <div class="banner-images">
        <img src="assets/abelardo.png" alt="Abelardo de la Espriella" class="leader-photo">
        <div class="event-title-section">
          <h1>
            <span class="title-line-1">ConvenciÃ³n Nacional</span>
            <div class="defensores-logo-banner">
              <img src="assets/defensores.png" alt="Defensores de la Patria" class="defensores-image-banner">
            </div>
          </h1>
          <p class="event-subtitle">Â¡COLOMBIA ESCUCHARÃ LO DURO QUE RUGEN LOS TIGRES!</p>
          <div class="event-details">
            <span class="event-date">ğŸ“… Lunes 3 de Noviembre - 3:00 p.m.</span>
            <span class="event-location">ğŸ“ Movistar Arena - BogotÃ¡</span>
          </div>
          <p class="event-leader">Abelardo de la Espriella - Nuestro MÃ¡ximo LÃ­der</p>
        </div>
        <img src="assets/tigre.png" alt="Tigre" class="tiger-image">
      </div>
    </div>

    <!-- BotÃ³n de cerrar sesiÃ³n -->
    <div class="logout-section">
      <button class="btn-logout" (click)="logout()" title="Cerrar sesiÃ³n">
        ğŸšª Cerrar SesiÃ³n
      </button>
    </div>

    <div class="stats-cards">
      <div class="stat-card total">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.total }}</div>
          <div class="stat-label">Total</div>
        </div>
      </div>
      <div class="stat-card confirmed">
        <div class="stat-icon">âœ…</div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.confirmados }}</div>
          <div class="stat-label">Confirmados</div>
        </div>
      </div>
      <div class="stat-card pending">
        <div class="stat-icon">â³</div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.pendientes }}</div>
          <div class="stat-label">Pendientes</div>
        </div>
      </div>
    </div>
  </div>

  <!-- BotÃ³n para agregar nuevo coordinador -->
  <div class="action-bar">
    <button class="btn-nuevo" (click)="abrirModalNuevo()">
      â• Agregar Coordinador
    </button>
    <button class="btn-exportar" (click)="exportarAExcel()">
      ğŸ“Š Exportar a Excel
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <div class="filter-group">
      <label>ğŸ™ï¸ Municipio:</label>
      <input 
        type="text" 
        [(ngModel)]="filtroMunicipio"
        (ngModelChange)="resetearPaginacion()"
        placeholder="Buscar por municipio..."
        class="filter-input">
    </div>
    <div class="filter-group">
      <label>ğŸ“Š Estado:</label>
      <select [(ngModel)]="filtroEstado" (ngModelChange)="resetearPaginacion()" class="filter-select">
        <option value="todos">Todos</option>
        <option value="confirmados">Confirmados</option>
        <option value="pendientes">Pendientes</option>
      </select>
    </div>
  </div>

  <!-- Tabla de coordinadores -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Municipio</th>
          <th>Coordinador</th>
          <th>Celular</th>
          <th>Estado</th>
          <th>Invitados</th>
          <th>Fecha Llamada</th>
          <th>Observaciones</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let coordinador of coordinadoresPaginados" 
            [class.confirmado-row]="coordinador.confirmado">
          <td><strong>{{ coordinador.municipio }}</strong></td>
          <td>{{ coordinador.nombreCompleto }}</td>
          <td>
            <a href="tel:{{ coordinador.celular }}" class="phone-link">
              {{ coordinador.celular }}
            </a>
          </td>
          <td>
            <span class="badge" [class.badge-success]="coordinador.confirmado" [class.badge-pending]="!coordinador.confirmado">
              {{ coordinador.confirmado ? 'Confirmado' : 'Pendiente' }}
            </span>
          </td>
          <td class="invitados-cell">
            <span class="invitados-number">{{ coordinador.numeroInvitados }}</span>
          </td>
          <td class="fecha-cell">{{ formatearFecha(coordinador.fechaLlamada) }}</td>
          <td class="observaciones-cell">{{ coordinador.observaciones || '-' }}</td>
          <td>
            <div class="action-buttons">
              <button 
                *ngIf="!coordinador.confirmado"
                class="btn btn-primary" 
                (click)="abrirModalConfirmacion(coordinador)"
                title="Confirmar llamada">
                âœ“
              </button>
              <button 
                *ngIf="coordinador.confirmado"
                class="btn btn-warning" 
                (click)="desmarcarConfirmacion(coordinador)"
                title="Desmarcar confirmaciÃ³n">
                â†º
              </button>
              <button 
                class="btn btn-info" 
                (click)="verInvitados(coordinador)"
                [disabled]="!coordinador.confirmado"
                title="Ver/Agregar invitados">
                ğŸ‘¥
              </button>
              <button 
                class="btn btn-danger" 
                (click)="eliminarCoordinador(coordinador)"
                title="Eliminar">
                <span class="icon-delete">ğŸ—‘</span>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="coordinadoresFiltrados.length === 0">
          <td colspan="8" class="empty-message">
            No se encontraron coordinadores
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Controles de paginaciÃ³n -->
  <div class="pagination-container" *ngIf="coordinadoresFiltrados.length > 0">
    <div class="pagination-info">
      <span>Mostrando {{ (paginaActual - 1) * itemsPorPagina + 1 }} - 
        {{ Math.min(paginaActual * itemsPorPagina, coordinadoresFiltrados.length) }} 
        de {{ coordinadoresFiltrados.length }} coordinadores</span>
      
      <div class="items-per-page">
        <label>Mostrar:</label>
        <select (change)="cambiarItemsPorPagina($event)" [value]="itemsPorPagina" class="page-size-select">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>por pÃ¡gina</span>
      </div>
    </div>

    <div class="pagination-controls" *ngIf="totalPaginas > 1">
      <button 
        class="page-btn" 
        (click)="cambiarPagina(1)" 
        [disabled]="paginaActual === 1"
        title="Primera pÃ¡gina">
        âŸª
      </button>
      <button 
        class="page-btn" 
        (click)="cambiarPagina(paginaActual - 1)" 
        [disabled]="paginaActual === 1"
        title="PÃ¡gina anterior">
        â€¹
      </button>

      <button 
        *ngFor="let pagina of paginasArray"
        class="page-btn" 
        [class.active]="pagina === paginaActual"
        (click)="cambiarPagina(pagina)">
        {{ pagina }}
      </button>

      <button 
        class="page-btn" 
        (click)="cambiarPagina(paginaActual + 1)" 
        [disabled]="paginaActual === totalPaginas"
        title="PÃ¡gina siguiente">
        â€º
      </button>
      <button 
        class="page-btn" 
        (click)="cambiarPagina(totalPaginas)" 
        [disabled]="paginaActual === totalPaginas"
        title="Ãšltima pÃ¡gina">
        âŸ«
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmaciÃ³n de llamada -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ğŸ“ Confirmar Llamada</h2>
      <button class="close-btn" (click)="cerrarModal()">âœ•</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorSeleccionado">
      <div class="modal-info">
        <p><strong>Municipio:</strong> {{ coordinadorSeleccionado.municipio }}</p>
        <p><strong>Coordinador:</strong> {{ coordinadorSeleccionado.nombreCompleto }}</p>
        <p><strong>Celular:</strong> {{ coordinadorSeleccionado.celular }}</p>
      </div>
      
      <div class="form-group">
        <label>Â¿CuÃ¡ntos invitados confirmÃ³?</label>
        <input 
          type="number" 
          [(ngModel)]="numeroInvitados" 
          min="0"
          class="form-control"
          placeholder="NÃºmero de invitados">
      </div>
      
      <div class="form-group">
        <label>Observaciones</label>
        <textarea 
          [(ngModel)]="observaciones" 
          rows="4"
          class="form-control"
          placeholder="Notas adicionales de la llamada..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModal()">Cancelar</button>
      <button class="btn btn-success" (click)="confirmarLlamada()">âœ… Confirmar Llamada</button>
    </div>
  </div>
</div>

<!-- Modal para nuevo coordinador -->
<div class="modal-overlay" *ngIf="mostrarModalNuevo" (click)="cerrarModalNuevo()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>â• Nuevo Coordinador</h2>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Municipio *</label>
        <input 
          type="text" 
          [(ngModel)]="nuevoCoordinador.municipio" 
          class="form-control"
          placeholder="Nombre del municipio">
      </div>
      
      <div class="form-group">
        <label>Nombre Completo *</label>
        <input 
          type="text" 
          [(ngModel)]="nuevoCoordinador.nombreCompleto" 
          class="form-control"
          placeholder="Nombre completo del coordinador">
      </div>
      
      <div class="form-group">
        <label>Celular *</label>
        <input 
          type="tel" 
          [(ngModel)]="nuevoCoordinador.celular" 
          class="form-control"
          placeholder="NÃºmero de celular">
      </div>
      
      <p class="form-note">* Campos obligatorios</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalNuevo()">Cancelar</button>
      <button class="btn btn-primary" (click)="guardarNuevoCoordinador()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- Modal de confirmaciÃ³n para eliminar coordinador -->
<div class="modal-overlay" *ngIf="mostrarModalEliminar" (click)="cerrarModalEliminar()">
  <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-header modal-header-danger">
      <h2>âš ï¸ Confirmar EliminaciÃ³n</h2>
      <button class="close-btn" (click)="cerrarModalEliminar()">âœ•</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorAEliminar">
      <div class="confirm-icon">
        <span class="icon-warning">ğŸ—‘ï¸</span>
      </div>
      <p class="confirm-message">
        Â¿EstÃ¡ seguro de que desea eliminar a este coordinador?
      </p>
      <div class="confirm-details">
        <p><strong>Municipio:</strong> {{ coordinadorAEliminar.municipio }}</p>
        <p><strong>Coordinador:</strong> {{ coordinadorAEliminar.nombreCompleto }}</p>
        <p><strong>Celular:</strong> {{ coordinadorAEliminar.celular }}</p>
        <p *ngIf="coordinadorAEliminar.confirmado" class="warning-text">
          âš ï¸ Este coordinador tiene {{ coordinadorAEliminar.numeroInvitados }} invitados confirmados
        </p>
      </div>
      <p class="confirm-warning">
        <strong>Esta acciÃ³n no se puede deshacer.</strong>
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEliminar()">Cancelar</button>
      <button class="btn btn-danger" (click)="confirmarEliminar()">
        ğŸ—‘ï¸ SÃ­, Eliminar
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmaciÃ³n para desmarcar -->
<div class="modal-overlay" *ngIf="mostrarModalDesmarcar" (click)="cerrarModalDesmarcar()">
  <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-header modal-header-warning">
      <h2>âš ï¸ Desmarcar ConfirmaciÃ³n</h2>
      <button class="close-btn" (click)="cerrarModalDesmarcar()">âœ•</button>
    </div>
    <div class="modal-body" *ngIf="coordinadorADesmarcar">
      <div class="confirm-icon">
        <span class="icon-warning">â†º</span>
      </div>
      <p class="confirm-message">
        Â¿EstÃ¡ seguro de que desea desmarcar la confirmaciÃ³n de llamada?
      </p>
      <div class="confirm-details">
        <p><strong>Municipio:</strong> {{ coordinadorADesmarcar.municipio }}</p>
        <p><strong>Coordinador:</strong> {{ coordinadorADesmarcar.nombreCompleto }}</p>
        <p><strong>Invitados registrados:</strong> {{ coordinadorADesmarcar.numeroInvitados }}</p>
      </div>
      <p class="confirm-warning">
        Esto marcarÃ¡ al coordinador como "Pendiente" nuevamente y borrarÃ¡ la fecha de llamada.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalDesmarcar()">Cancelar</button>
      <button class="btn btn-warning" (click)="confirmarDesmarcar()">
        â†º SÃ­, Desmarcar
      </button>
    </div>
  </div>
</div>
